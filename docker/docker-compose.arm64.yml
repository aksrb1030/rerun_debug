version: "3.8"

services:
  rerun-bridge:
    platform: linux/arm64
    build:
      context: ..
      dockerfile: docker/Dockerfile.arm64
    environment:
      P13_NAME: ${P13_NAME:-P13}
      RERUN_MODE: ${RERUN_MODE:-connect}
      RERUN_SERVER: ${RERUN_SERVER:-127.0.0.1:9876}
      ROS_WORKSPACE: ${ROS_WORKSPACE:-}
      ROS_DISTRO: ${ROS_DISTRO:-humble}
    network_mode: host
    command: >-
      bash -lc "source /opt/ros/${ROS_DISTRO:-humble}/setup.bash && \
      if [ -n \"$${ROS_WORKSPACE}\" ]; then source \"$${ROS_WORKSPACE}\"/install/setup.bash; fi && \
      /app/build/p13_rerun_bridge"
    tty: true
