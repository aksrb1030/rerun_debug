version: "3.8"

services:
  rerun-bridge:
    platform: ${DOCKER_PLATFORM:-linux/amd64}
    build:
      context: .
      dockerfile: ${DOCKERFILE:-docker/Dockerfile.amd64}
      args:
        ROS_DISTRO: ${ROS_DISTRO:-humble}
    environment:
      P13_NAME: ${P13_NAME:-P13}
      RERUN_MODE: ${RERUN_MODE:-connect}
      RERUN_SERVER: ${RERUN_SERVER:-127.0.0.1:9876}
      ROS_WORKSPACE: ${ROS_WORKSPACE:-}
      ROS_DISTRO: ${ROS_DISTRO:-humble}
    network_mode: host
    command: >-
      bash -lc "source /opt/ros/${ROS_DISTRO:-humble}/setup.bash &&
      if [ -n \"$${ROS_WORKSPACE}\" ]; then source \"$${ROS_WORKSPACE}\"/install/setup.bash; fi &&
      python3 /app/src/p13_rerun_bridge.py"
    tty: true
